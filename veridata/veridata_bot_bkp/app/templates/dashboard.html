{% extends "base.html" %}

{% block content %}
<div class="header">
    <div style="display: flex; align-items: center; gap: 1rem;">
        <img src="/static/logo.png" style="height: 48px; width: auto;" alt="Logo">
        <h1 style="margin: 0;">Tenant Mappings</h1>
    </div>
    <div style="display: flex; gap: 1rem;">
        <a href="/admin/sessions" class="btn btn-secondary">
            Sessions â†’
        </a>
        <form action="/admin/logout" method="post" style="margin: 0;">
            <button type="submit" class="btn btn-secondary">Logout</button>
        </form>
    </div>
</div>

<div class="card" style="margin-bottom: 2rem;">
    <h3 style="margin-top:0;">Add or Update Bot</h3>
    <form hx-post="/admin/mappings" hx-target="#mappings-body" hx-swap="beforeend" hx-on::after-request="this.reset()"
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">

        <div class="form-control">
            <label>Evolution Instance or Telegram Alias</label>
            <input type="text" name="instance_name" placeholder="MyBot" required>
        </div>
        <div class="form-control">
            <label>Platform Bot Token (Telegram/Chatwoot)</label>
            <input type="text" name="platform_token" placeholder="Token... (Leave empty for Evolution)">
        </div>
        <div class="form-control">
            <label>VeriData RAG Tenant ID</label>
            <input type="text" name="tenant_id" placeholder="UUID" required>
        </div>
        <div class="form-control">
            <label>User Password</label>
            <input type="text" name="access_key" placeholder="1234ABDC">
        </div>
        <div class="form-control">
            <label>Message Limit (Monthly)</label>
            <input type="number" name="message_limit" value="1000">
        </div>
        <div class="form-control">
            <label>Renewal Date</label>
            <input type="date" name="renewal_date">
        </div>
        <div class="full-width" style="grid-column: 1 / -1; margin-top: 0.5rem;">
            <button type="submit" class="btn btn-primary" style="width: 100%;">Add or Update Mapping</button>
        </div>
    </form>
</div>

<div class="table-responsive">
    <table>
        <thead>
            <tr>
                <th>Instance Name (Alias)</th>
                <th>Status</th>
                <th>Usage</th>
                <th>Renewal</th>
                <th>Type</th>
                <th>Tenant ID</th>
                <th>Access Key</th>
                <th style="text-align: right;">Actions</th>
            </tr>
        </thead>
        <tbody id="mappings-body">
            {% for mapping in mappings %}
            {% include "partials/mapping_row.html" %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}